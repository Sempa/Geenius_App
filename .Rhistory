ungroup() %>%
mutate(s_id = as.character(s_id)) %>%
dplyr::filter(s_id == (id[[i]])) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
t_1 <- dat$time_t[1]
cum_prob <- dat$cumsum_posterior[1]
print(i)
while ((cum_prob +f_p) <1 & t_1 < max(dat$time_t)) {
prob_sum <- cum_prob + f_p
t_2 <- approx(x = dat$cumsum_posterior, y = dat$time_t,
xout = prob_sum, method = "constant", ties = mean, rule = 2)$y
dt <- rbind(dt, cbind(id = dat$s_id[i], f_p = f_p, cum_prob = cum_prob, sum_prob = prob_sum, t_1_val = t_1, t_2_val = t_2, t_diff = t_2 - t_1))
t_1 <- t_1 + 1
cum_prob <- dat$cumsum_posterior[dat$time_t==t_1]
}
}
dat <- cumulative_posterior %>%
ungroup() %>%
mutate(s_id = as.character(s_id)) %>%
dplyr::filter(s_id == (id[i])) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
dat <- cumulative_posterior %>%
ungroup() %>%
mutate(s_id = as.character(s_id)) %>%
dplyr::filter(s_id == !!sym(id[i])) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
dat <- cumulative_posterior %>%
ungroup() %>%
mutate(s_id = as.character(s_id)) %>%
dplyr::filter(s_id == !!sym(id[i])) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
rlang::last_error()
rlang::last_trace()
dat <- cumulative_posterior %>%
ungroup() %>%
mutate(s_id = as.character(s_id)) %>%
dplyr::filter(s_id == !!sym(id[i])) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
f_p <- .5
dt <- data.frame(id = NA, f_p = NA, cum_prob = NA, sum_prob = NA, t_1_val = NA, t_2_val = NA, t_diff = NA)
id <- as.character(unique(cumulative_posterior$s_id))
for (i in seq_along(id)) {
dat <- cumulative_posterior %>%
ungroup() %>%
mutate(s_id = as.character(s_id)) %>%
dplyr::filter(s_id == !!sym(id[i])) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
t_1 <- dat$time_t[1]
cum_prob <- dat$cumsum_posterior[1]
print(i)
while ((cum_prob +f_p) <1 & t_1 < max(dat$time_t)) {
prob_sum <- cum_prob + f_p
t_2 <- approx(x = dat$cumsum_posterior, y = dat$time_t,
xout = prob_sum, method = "constant", ties = mean, rule = 2)$y
dt <- rbind(dt, cbind(id = dat$s_id[i], f_p = f_p, cum_prob = cum_prob, sum_prob = prob_sum, t_1_val = t_1, t_2_val = t_2, t_diff = t_2 - t_1))
t_1 <- t_1 + 1
cum_prob <- dat$cumsum_posterior[dat$time_t==t_1]
}
}
dat <- cumulative_posterior %>%
ungroup() %>%
mutate(s_id = as.character(s_id)) %>%
dplyr::filter(s_id == (id[[i]]))
dat <- cumulative_posterior %>%
ungroup() %>%
mutate(s_id = as.character(s_id)) %>%
dplyr::filter(s_id == (id[i]))
dat <- cumulative_posterior %>%
ungroup() %>%
# mutate(s_id = as.character(s_id)) %>%
dplyr::filter(s_id %in% c(i)) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
i
dt <- data.frame(id = NA, f_p = NA, cum_prob = NA, sum_prob = NA, t_1_val = NA, t_2_val = NA, t_diff = NA)
id <- as.character(unique(cumulative_posterior$s_id))
for (i in seq_along(id)) {
dat <- cumulative_posterior %>%
ungroup() %>%
# mutate(s_id = as.character(s_id)) %>%
dplyr::filter(s_id %in% c(i)) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
t_1 <- dat$time_t[1]
cum_prob <- dat$cumsum_posterior[1]
print(i)
while ((cum_prob +f_p) <1 & t_1 < max(dat$time_t)) {
prob_sum <- cum_prob + f_p
t_2 <- approx(x = dat$cumsum_posterior, y = dat$time_t,
xout = prob_sum, method = "constant", ties = mean, rule = 2)$y
dt <- rbind(dt, cbind(id = dat$s_id[i], f_p = f_p, cum_prob = cum_prob, sum_prob = prob_sum, t_1_val = t_1, t_2_val = t_2, t_diff = t_2 - t_1))
t_1 <- t_1 + 1
cum_prob <- dat$cumsum_posterior[dat$time_t==t_1]
}
}
View(dt)
dat <- cumulative_posterior %>%
ungroup() %>%
mutate(s_id = as.character(s_id)) %>%
dplyr::filter(s_id == get(id[i])) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
dt <- data.frame(id = NA, f_p = NA, cum_prob = NA, sum_prob = NA, t_1_val = NA, t_2_val = NA, t_diff = NA)
id <- as.character(unique(cumulative_posterior$s_id))
for (i in seq_along(id)) {
dat <- cumulative_posterior %>%
ungroup() %>%
# mutate(s_id = as.character(s_id)) %>%
dplyr::filter(s_id == get(i)) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
t_1 <- dat$time_t[1]
cum_prob <- dat$cumsum_posterior[1]
print(i)
while ((cum_prob +f_p) <1 & t_1 < max(dat$time_t)) {
prob_sum <- cum_prob + f_p
t_2 <- approx(x = dat$cumsum_posterior, y = dat$time_t,
xout = prob_sum, method = "constant", ties = mean, rule = 2)$y
dt <- rbind(dt, cbind(id = dat$s_id[i], f_p = f_p, cum_prob = cum_prob, sum_prob = prob_sum, t_1_val = t_1, t_2_val = t_2, t_diff = t_2 - t_1))
t_1 <- t_1 + 1
cum_prob <- dat$cumsum_posterior[dat$time_t==t_1]
}
}
dat <- cumulative_posterior %>%
ungroup() %>%
# mutate(s_id = as.character(s_id)) %>%
dplyr::filter(s_id %in% get(i)) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
for (i in id) {
dat <- cumulative_posterior %>%
ungroup() %>%
# mutate(s_id = as.character(s_id)) %>%
dplyr::filter(s_id %in% get(i)) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
t_1 <- dat$time_t[1]
cum_prob <- dat$cumsum_posterior[1]
print(i)
while ((cum_prob +f_p) <1 & t_1 < max(dat$time_t)) {
prob_sum <- cum_prob + f_p
t_2 <- approx(x = dat$cumsum_posterior, y = dat$time_t,
xout = prob_sum, method = "constant", ties = mean, rule = 2)$y
dt <- rbind(dt, cbind(id = dat$s_id[i], f_p = f_p, cum_prob = cum_prob, sum_prob = prob_sum, t_1_val = t_1, t_2_val = t_2, t_diff = t_2 - t_1))
t_1 <- t_1 + 1
cum_prob <- dat$cumsum_posterior[dat$time_t==t_1]
}
}
dat <- cumulative_posterior %>%
ungroup() %>%
# mutate(s_id = as.character(s_id)) %>%
dplyr::filter(s_id == get(i)) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
for (i in 1:length(unique(cumulative_posterior$s_id))) {
dat <- cumulative_posterior %>%
ungroup() %>%
# mutate(s_id = as.character(s_id)) %>%
dplyr::filter(s_id == get(i)) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
t_1 <- dat$time_t[1]
cum_prob <- dat$cumsum_posterior[1]
print(i)
while ((cum_prob +f_p) <1 & t_1 < max(dat$time_t)) {
prob_sum <- cum_prob + f_p
t_2 <- approx(x = dat$cumsum_posterior, y = dat$time_t,
xout = prob_sum, method = "constant", ties = mean, rule = 2)$y
dt <- rbind(dt, cbind(id = dat$s_id[i], f_p = f_p, cum_prob = cum_prob, sum_prob = prob_sum, t_1_val = t_1, t_2_val = t_2, t_diff = t_2 - t_1))
t_1 <- t_1 + 1
cum_prob <- dat$cumsum_posterior[dat$time_t==t_1]
}
}
rlang::last_error()
dat <- cumulative_posterior %>%
ungroup() %>%
# mutate(s_id = as.character(s_id)) %>%
filter(s_id == i) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
i=2
dat <- cumulative_posterior %>%
ungroup() %>%
# mutate(s_id = as.character(s_id)) %>%
filter(s_id == i) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
f_p <- .5
dt <- data.frame(id = NA, f_p = NA, cum_prob = NA, sum_prob = NA, t_1_val = NA, t_2_val = NA, t_diff = NA)
id <- as.character(unique(cumulative_posterior$s_id))
for (i in 1:length(unique(cumulative_posterior$s_id))) {
dat <- cumulative_posterior %>%
ungroup() %>%
# mutate(s_id = as.character(s_id)) %>%
filter(s_id == i) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
t_1 <- dat$time_t[1]
cum_prob <- dat$cumsum_posterior[1]
print(i)
while ((cum_prob +f_p) <1 & t_1 < max(dat$time_t)) {
prob_sum <- cum_prob + f_p
t_2 <- approx(x = dat$cumsum_posterior, y = dat$time_t,
xout = prob_sum, method = "constant", ties = mean, rule = 2)$y
dt <- rbind(dt, cbind(id = dat$s_id[i], f_p = f_p, cum_prob = cum_prob, sum_prob = prob_sum, t_1_val = t_1, t_2_val = t_2, t_diff = t_2 - t_1))
t_1 <- t_1 + 1
cum_prob <- dat$cumsum_posterior[dat$time_t==t_1]
}
}
View(dat)
f_p <- .5
dt <- data.frame(id = NA, f_p = NA, cum_prob = NA, sum_prob = NA, t_1_val = NA, t_2_val = NA, t_diff = NA)
dt2 <- data.frame(id = NA, f_p = NA, cum_prob = NA, sum_prob = NA, t_1_val = NA, t_2_val = NA, t_diff = NA)
id <- as.character(unique(cumulative_posterior$s_id))
for (i in 1:length(unique(cumulative_posterior$s_id))) {
dat <- cumulative_posterior %>%
ungroup() %>%
# mutate(s_id = as.character(s_id)) %>%
filter(s_id == i) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
t_1 <- dat$time_t[1]
cum_prob <- dat$cumsum_posterior[1]
print(i)
while ((cum_prob +f_p) <1 & t_1 < max(dat$time_t)) {
prob_sum <- cum_prob + f_p
t_2 <- approx(x = dat$cumsum_posterior, y = dat$time_t,
xout = prob_sum, method = "constant", ties = mean, rule = 2)$y
dt <- rbind(dt, cbind(id = dat$s_id[i], f_p = f_p, cum_prob = cum_prob, sum_prob = prob_sum, t_1_val = t_1, t_2_val = t_2, t_diff = t_2 - t_1))
t_1 <- t_1 + 1
cum_prob <- dat$cumsum_posterior[dat$time_t==t_1]
}
dy2 <- rbind(dt2, dt)
}
dt <- data.frame(id = NA, f_p = NA, cum_prob = NA, sum_prob = NA, t_1_val = NA, t_2_val = NA, t_diff = NA)
dt2 <- data.frame(id = NA, f_p = NA, cum_prob = NA, sum_prob = NA, t_1_val = NA, t_2_val = NA, t_diff = NA)
id <- as.character(unique(cumulative_posterior$s_id))
for (i in 1:length(unique(cumulative_posterior$s_id))) {
dat <- cumulative_posterior %>%
ungroup() %>%
# mutate(s_id = as.character(s_id)) %>%
filter(s_id == i) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
t_1 <- dat$time_t[1]
cum_prob <- dat$cumsum_posterior[1]
print(i)
while ((cum_prob +f_p) <1 & t_1 < max(dat$time_t)) {
prob_sum <- cum_prob + f_p
t_2 <- approx(x = dat$cumsum_posterior, y = dat$time_t,
xout = prob_sum, method = "constant", ties = mean, rule = 2)$y
dt <- rbind(dt, cbind(id = dat$s_id[i], f_p = f_p, cum_prob = cum_prob, sum_prob = prob_sum, t_1_val = t_1, t_2_val = t_2, t_diff = t_2 - t_1))
t_1 <- t_1 + 1
cum_prob <- dat$cumsum_posterior[dat$time_t==t_1]
}
dt2 <- rbind(dt2, dt)
}
View(dt2)
f_p <- .5
dt2 <- data.frame(id = NA, f_p = NA, cum_prob = NA, sum_prob = NA, t_1_val = NA, t_2_val = NA, t_diff = NA)
id <- as.character(unique(cumulative_posterior$s_id))
for (i in 1:length(unique(cumulative_posterior$s_id))) {
dat <- cumulative_posterior %>%
ungroup() %>%
# mutate(s_id = as.character(s_id)) %>%
filter(s_id == i) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
t_1 <- dat$time_t[1]
cum_prob <- dat$cumsum_posterior[1]
dt <- data.frame(id = NA, f_p = NA, cum_prob = NA, sum_prob = NA, t_1_val = NA, t_2_val = NA, t_diff = NA)
while ((cum_prob +f_p) <1 & t_1 < max(dat$time_t)) {
prob_sum <- cum_prob + f_p
t_2 <- approx(x = dat$cumsum_posterior, y = dat$time_t,
xout = prob_sum, method = "constant", ties = mean, rule = 2)$y
dt <- rbind(dt, cbind(id = dat$s_id[i], f_p = f_p, cum_prob = cum_prob, sum_prob = prob_sum, t_1_val = t_1, t_2_val = t_2, t_diff = t_2 - t_1))
t_1 <- t_1 + 1
cum_prob <- dat$cumsum_posterior[dat$time_t==t_1]
}
dt2 <- rbind(dt2, dt)
}
dt2 <- data.frame(id = NA, f_p = NA, cum_prob = NA, sum_prob = NA, t_1_val = NA, t_2_val = NA, t_diff = NA)
id <- as.character(unique(cumulative_posterior$s_id))
for (i in 1:length(unique(cumulative_posterior$s_id))) {
dat <- cumulative_posterior %>%
ungroup() %>%
# mutate(s_id = as.character(s_id)) %>%
filter(s_id == i) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
t_1 <- dat$time_t[1]
cum_prob <- dat$cumsum_posterior[1]
dt <- data.frame(id = NA, f_p = NA, cum_prob = NA, sum_prob = NA, t_1_val = NA, t_2_val = NA, t_diff = NA)
while ((cum_prob +f_p) <1 & t_1 < max(dat$time_t)) {
prob_sum <- cum_prob + f_p
t_2 <- approx(x = dat$cumsum_posterior, y = dat$time_t,
xout = prob_sum, method = "constant", ties = mean, rule = 2)$y
dt <- rbind(dt, cbind(id = dat$s_id[i], f_p = f_p, cum_prob = cum_prob, sum_prob = prob_sum, t_1_val = t_1, t_2_val = t_2, t_diff = t_2 - t_1))
t_1 <- t_1 + 1
cum_prob <- dat$cumsum_posterior[dat$time_t==t_1]
}
print(i)
dt2 <- rbind(dt2, dt)
}
View(dt)
dt2 <- data.frame(id = NA, f_p = NA, cum_prob = NA, sum_prob = NA, t_1_val = NA, t_2_val = NA, t_diff = NA)
id <- as.character(unique(cumulative_posterior$s_id))
for (i in 1:length(unique(cumulative_posterior$s_id))) {
dat <- cumulative_posterior %>%
ungroup() %>%
# mutate(s_id = as.character(s_id)) %>%
filter(s_id == i) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
t_1 <- dat$time_t[1]
cum_prob <- dat$cumsum_posterior[1]
dt <- data.frame(id = NA, f_p = NA, cum_prob = NA, sum_prob = NA, t_1_val = NA, t_2_val = NA, t_diff = NA)
while ((cum_prob +f_p) <1 & t_1 < max(dat$time_t)) {
prob_sum <- cum_prob + f_p
t_2 <- approx(x = dat$cumsum_posterior, y = dat$time_t,
xout = prob_sum, method = "constant", ties = mean, rule = 2)$y
dt <- rbind(dt, cbind(id = dat$s_id[i], f_p = f_p, cum_prob = cum_prob, sum_prob = prob_sum, t_1_val = t_1, t_2_val = t_2, t_diff = t_2 - t_1))
t_1 <- t_1 + 1
cum_prob <- dat$cumsum_posterior[dat$time_t==t_1]
}
browser()
print(i)
dt2 <- rbind(dt2, dt)
}
View(dt)
View(dt2)
View(dat)
cumulative_posterior <- complete_dataset %>%
dplyr::group_by(s_id) %>%
mutate(cumsum_posterior = cumsum(bigL)) %>%
mutate(f_T = f_T,
t1 = time_t,
window_size= round(int_length * f_T, 0),
t1_f_T = ifelse(t1 + window_size <= int_length, t1 + window_size, int_length)
) %>%
mutate(id  = paste(s_id, t1, sep = '_'))
View(cumulative_posterior)
cumulative_posterior <- complete_dataset %>%
group_by(s_id) %>%
mutate(cumsum_posterior = cumsum(bigL)) %>%
mutate(f_T = f_T,
t1 = time_t,
window_size= round(int_length * f_T, 0),
t1_f_T = ifelse(t1 + window_size <= int_length, t1 + window_size, int_length)
) %>%
mutate(id  = paste(s_id, t1, sep = '_'))
cumulative_posterior <- complete_dataset %>%
group_by(s_id) %>%
dplyr::mutate(cumsum_posterior = cumsum(bigL)) %>%
mutate(f_T = f_T,
t1 = time_t,
window_size= round(int_length * f_T, 0),
t1_f_T = ifelse(t1 + window_size <= int_length, t1 + window_size, int_length)
) %>%
mutate(id  = paste(s_id, t1, sep = '_'))
f_p <- .5
cumulative_posterior <- complete_dataset %>%
group_by(s_id) %>%
dplyr::mutate(cumsum_posterior = cumsum(bigL)) %>%
dplyr::mutate(f_T = f_T,
t1 = time_t,
window_size= round(int_length * f_T, 0),
t1_f_T = ifelse(t1 + window_size <= int_length, t1 + window_size, int_length)
) %>%
mutate(id  = paste(s_id, t1, sep = '_'))
dt2 <- data.frame(id = NA, f_p = NA, cum_prob = NA, sum_prob = NA, t_1_val = NA, t_2_val = NA, t_diff = NA)
id <- as.character(unique(cumulative_posterior$s_id))
for (i in 1:length(unique(cumulative_posterior$s_id))) {
dat <- cumulative_posterior %>%
ungroup() %>%
# mutate(s_id = as.character(s_id)) %>%
filter(s_id == i) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
t_1 <- dat$time_t[1]
cum_prob <- dat$cumsum_posterior[1]
dt <- data.frame(id = NA, f_p = NA, cum_prob = NA, sum_prob = NA, t_1_val = NA, t_2_val = NA, t_diff = NA)
while ((cum_prob +f_p) <1 & t_1 < max(dat$time_t)) {
prob_sum <- cum_prob + f_p
t_2 <- approx(x = dat$cumsum_posterior, y = dat$time_t,
xout = prob_sum, method = "constant", ties = mean, rule = 2)$y
dt <- rbind(dt, cbind(id = dat$s_id[i], f_p = f_p, cum_prob = cum_prob, sum_prob = prob_sum, t_1_val = t_1, t_2_val = t_2, t_diff = t_2 - t_1))
t_1 <- t_1 + 1
cum_prob <- dat$cumsum_posterior[dat$time_t==t_1]
}
browser()
print(i)
dt2 <- rbind(dt2, dt)
}
dt2 <- data.frame(id = NA, f_p = NA, cum_prob = NA, sum_prob = NA, t_1_val = NA, t_2_val = NA, t_diff = NA)
id <- as.character(unique(cumulative_posterior$s_id))
for (i in 1:length(unique(cumulative_posterior$s_id))) {
dat <- cumulative_posterior %>%
ungroup() %>%
# mutate(s_id = as.character(s_id)) %>%
filter(s_id == i) %>%
dplyr::select(s_id, time_t, cumsum_posterior)
t_1 <- dat$time_t[1]
cum_prob <- dat$cumsum_posterior[1]
dt <- data.frame(id = NA, f_p = NA, cum_prob = NA, sum_prob = NA, t_1_val = NA, t_2_val = NA, t_diff = NA)
while ((cum_prob +f_p) <1 & t_1 < max(dat$time_t)) {
prob_sum <- cum_prob + f_p
t_2 <- approx(x = dat$cumsum_posterior, y = dat$time_t,
xout = prob_sum, method = "constant", ties = mean, rule = 2)$y
dt <- rbind(dt, cbind(id = dat$s_id[i], f_p = f_p, cum_prob = cum_prob, sum_prob = prob_sum, t_1_val = t_1, t_2_val = t_2, t_diff = t_2 - t_1))
t_1 <- t_1 + 1
cum_prob <- dat$cumsum_posterior[dat$time_t==t_1]
}
# browser()
# print(i)
dt2 <- rbind(dt2, dt)
}
View(dt2)
dt3 <- dt2 %>%
dplyr::filter(!is.na(s_id))
View(dt2)
dt3 <- dt2 %>%
dplyr::filter(!is.na(id))
View(dt3)
dt3 <- dt2 %>%
dplyr::filter(!is.na(id)) %>%
group_by(id) %>%
mutate(min_diff = min(t_diff))
dt3 <- dt2 %>%
dplyr::filter(!is.na(id)) %>%
group_by(id) %>%
mutate(min_diff = min(t_diff)) %>%
filter(t_diff == min_diff)
View(dt3)
dt3 <- dt2 %>%
dplyr::filter(!is.na(id)) %>%
group_by(id) %>%
dplyr::mutate(min_diff = min(t_diff)) %>%
filter(t_diff == min_diff)
View(dt3)
dt3 <- dt2 %>%
dplyr::filter(!is.na(id)) %>%
group_by(id) %>%
dplyr::mutate(min_diff = min(t_diff)) %>%
filter(t_diff == min_diff) %>%
dplyr::mutate(min_t = min(t_1_val, na.rm = T),
max_t = max(t_2_val, na.rm = T)
)
View(cumulative_posterior)
dt3 <- dt2 %>%
dplyr::filter(!is.na(id)) %>%
group_by(id) %>%
dplyr::mutate(min_diff = min(t_diff)) %>%
filter(t_diff == min_diff) %>%
dplyr::mutate(ide_lower = min(t_1_val, na.rm = T),
ide_upper = max(t_2_val, na.rm = T)
) %>%
dplyr::mutate(ide_midpoint = ide_lower + (ide_upper-ide_lower)/2,
ide_radius = (ide_upper-ide_lower)/2) %>%
ungroup() %>%
distinct(id, .keep_all = T)
names(dt3)
names(cumulative_posterior)
View(summay_dataset_2)
View(merged_dataset)
f_t_results <- merged_dataset %>%
dplyr::mutate(id = paste(s_id, time_t, sep = '_'))
f_t_results <- merged_dataset %>%
dplyr::mutate(id = paste(s_id, time_t, sep = '_')) %>%
right_join(summary_dataset_2 %>% mutate(id = paste(s_id, max_window_prob, sep = '_')))
summary_dataset_2 <- merged_dataset %>%
group_by(s_id) %>%
dplyr::summarise(max_window_prob = approx(x = window_probs_t1, y = time_t,
xout = max(window_probs_t1, na.rm = T), method = "constant", ties = mean, rule = 2)$y
)
f_t_results <- merged_dataset %>%
dplyr::mutate(id = paste(s_id, time_t, sep = '_')) %>%
right_join(summary_dataset_2 %>% mutate(id = paste(s_id, max_window_prob, sep = '_')))
View(f_t_results)
names(f_t_results)
f_t_results <- merged_dataset %>%
dplyr::mutate(id = paste(s_id, time_t, sep = '_')) %>%
right_join(summary_dataset_2 %>% mutate(id = paste(s_id, max_window_prob, sep = '_'))) %>%
dplyr::select(s_id, time_t, assay_value, int_length, f_T, t1, window_size, t1_f_T,
max_window_prob)
f_t_results <- merged_dataset %>%
dplyr::mutate(id = paste(s_id, time_t, sep = '_')) %>%
right_join(summary_dataset_2 %>% mutate(id = paste(s_id, max_window_prob, sep = '_'))) %>%
dplyr::select(s_id, assay_value, int_length, f_T, ide_f_t_lower = t1,
window_size, ide_f_t_lower = t1_f_T)
f_t_results <- merged_dataset %>%
dplyr::mutate(id = paste(s_id, time_t, sep = '_')) %>%
right_join(summary_dataset_2 %>% mutate(id = paste(s_id, max_window_prob, sep = '_'))) %>%
dplyr::select(s_id, assay_value, int_length, f_T, ide_f_t_lower = t1,
window_size, ide_f_t_upper = t1_f_T)
dt3 <- dt2 %>%
dplyr::filter(!is.na(id)) %>%
group_by(id) %>%
dplyr::mutate(min_diff = min(t_diff)) %>%
filter(t_diff == min_diff) %>%
dplyr::mutate(ide_lower = min(t_1_val, na.rm = T),
ide_upper = max(t_2_val, na.rm = T)
) %>%
dplyr::mutate(ide_midpoint = ide_lower + (ide_upper-ide_lower)/2,
ide_radius = (ide_upper-ide_lower)/2) %>%
ungroup() %>%
distinct(id, .keep_all = T) %>%
dplyr::select(id, f_p, ide_lower, ide_upper, ide_midpoint, ide_radius) %>%
left_join(f_t_results %>% mutate(id = s_id), by = 'id')
View(dt3)
names(dt3)
dt3 <- dt2 %>%
dplyr::filter(!is.na(id)) %>%
group_by(id) %>%
dplyr::mutate(min_diff = min(t_diff)) %>%
filter(t_diff == min_diff) %>%
dplyr::mutate(ide_lower = min(t_1_val, na.rm = T),
ide_upper = max(t_2_val, na.rm = T)
) %>%
dplyr::mutate(ide_midpoint = ide_lower + (ide_upper-ide_lower)/2,
ide_radius = (ide_upper-ide_lower)/2) %>%
ungroup() %>%
distinct(id, .keep_all = T) %>%
dplyr::select(id, f_p, ide_lower, ide_upper, ide_midpoint, ide_radius) %>%
left_join(f_t_results %>% mutate(id = s_id), by = 'id') %>%
dplyr::select(id, assay_value, f_T, f_p, int_length, ide_lower, `f_p ide_upper` = ide_upper,
`f_p ide midpoint` = ide_midpoint, `f_p ide radius` = ide_radius,
`f_t ide lower` = ide_f_t_lower, `f_t window_size` = window_size,
`f_t ide upper` = ide_f_t_upper)
